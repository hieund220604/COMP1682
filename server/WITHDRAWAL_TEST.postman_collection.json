{
    "info": {
        "name": "Withdrawal API Test",
        "description": "Complete withdrawal feature testing with OTP verification",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "1. Initiate Withdrawal (Auto-sends OTP)",
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    },
                    {
                        "key": "Authorization",
                        "value": "Bearer {{access_token}}"
                    }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{\n  \"amount\": 100000,\n  \"accountNumber\": \"1234567890\",\n  \"bankName\": \"Vietcombank\",\n  \"accountName\": \"Nguyen Van A\"\n}"
                },
                "url": {
                    "raw": "http://localhost:8080/api/withdrawals",
                    "protocol": "http",
                    "host": [
                        "localhost"
                    ],
                    "port": "8080",
                    "path": [
                        "api",
                        "withdrawals"
                    ]
                },
                "description": "Create a new withdrawal request. OTP is sent automatically to user email.\n\nRequired fields:\n- amount: number (must be â‰¤ user balance)\n- accountNumber: string\n- bankName: string\n- accountName: string\n\nResponse includes withdrawalId needed for next steps.\nStatus immediately becomes OTP_SENT."
            },
            "response": []
        },
        {
            "name": "2. Resend OTP (If not received)",
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    },
                    {
                        "key": "Authorization",
                        "value": "Bearer {{access_token}}"
                    }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{}"
                },
                "url": {
                    "raw": "http://localhost:8080/api/withdrawals/{{withdrawalId}}/resend-otp",
                    "protocol": "http",
                    "host": [
                        "localhost"
                    ],
                    "port": "8080",
                    "path": [
                        "api",
                        "withdrawals",
                        "{{withdrawalId}}",
                        "resend-otp"
                    ]
                },
                "description": "Resend OTP if user didn't receive the first one. New OTP generated, valid for 10 minutes.\n\nCheck your email console for the OTP code."
            },
            "response": []
        },
        {
            "name": "3. Verify OTP",
            "request": {
                "method": "POST",
                "header": [
                    {
                        "key": "Content-Type",
                        "value": "application/json"
                    },
                    {
                        "key": "Authorization",
                        "value": "Bearer {{access_token}}"
                    }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{\n  \"otp\": \"123456\"\n}"
                },
                "url": {
                    "raw": "http://localhost:8080/api/withdrawals/{{withdrawalId}}/verify-otp",
                    "protocol": "http",
                    "host": [
                        "localhost"
                    ],
                    "port": "8080",
                    "path": [
                        "api",
                        "withdrawals",
                        "{{withdrawalId}}",
                        "verify-otp"
                    ]
                },
                "description": "Verify the 6-digit OTP sent to email. Status changes to COMPLETED.\nBalance is deducted immediately in an atomic transaction.\n\nReplace '123456' with the actual OTP from email.\n\nResponse includes:\n- Withdrawal details\n- New user balance after deduction"
            },
            "response": []
        },
        {
            "name": "4. Get Withdrawal Status",
            "request": {
                "method": "GET",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{access_token}}"
                    }
                ],
                "url": {
                    "raw": "http://localhost:8080/api/withdrawals/{{withdrawalId}}",
                    "protocol": "http",
                    "host": [
                        "localhost"
                    ],
                    "port": "8080",
                    "path": [
                        "api",
                        "withdrawals",
                        "{{withdrawalId}}"
                    ]
                },
                "description": "Check current status of a withdrawal request.\n\nStatus can be: OTP_SENT, COMPLETED, FAILED"
            },
            "response": []
        },
        {
            "name": "5. List User Withdrawals",
            "request": {
                "method": "GET",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{access_token}}"
                    }
                ],
                "url": {
                    "raw": "http://localhost:8080/api/withdrawals",
                    "protocol": "http",
                    "host": [
                        "localhost"
                    ],
                    "port": "8080",
                    "path": [
                        "api",
                        "withdrawals"
                    ]
                },
                "description": "Get all withdrawals for the authenticated user, ordered by most recent first."
            },
            "response": []
        },
        {
            "name": "Check User Balance (Before)",
            "request": {
                "method": "GET",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{access_token}}"
                    }
                ],
                "url": {
                    "raw": "http://localhost:8080/api/accounts/me",
                    "protocol": "http",
                    "host": [
                        "localhost"
                    ],
                    "port": "8080",
                    "path": [
                        "api",
                        "accounts",
                        "me"
                    ]
                },
                "description": "Check user balance before withdrawal."
            },
            "response": []
        },
        {
            "name": "Check User Balance (After)",
            "request": {
                "method": "GET",
                "header": [
                    {
                        "key": "Authorization",
                        "value": "Bearer {{access_token}}"
                    }
                ],
                "url": {
                    "raw": "http://localhost:8080/api/withdrawals",
                    "protocol": "http",
                    "host": [
                        "localhost"
                    ],
                    "port": "8080",
                    "path": [
                        "api",
                        "withdrawals"
                    ]
                },
                "description": "Check user balance after withdrawal completion to verify deduction."
            },
            "response": []
        }
    ],
    "variable": [
        {
            "key": "access_token",
            "value": "your_jwt_token_here",
            "type": "string"
        },
        {
            "key": "withdrawalId",
            "value": "withdrawal_id_from_step_1",
            "type": "string"
        }
    ]
}